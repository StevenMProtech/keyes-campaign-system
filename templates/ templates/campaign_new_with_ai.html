<!DOCTYPE html>
<html>
<head>
    <title>New Campaign - The Keyes Company</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #f7f3e5;
            padding: 40px 20px;
        }
        .container { max-width: 900px; margin: 0 auto; }
        .header {
            background: linear-gradient(135deg, #004237 0%, #003329 100%);
            color: white;
            padding: 30px 40px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .ai-section {
            background: linear-gradient(135deg, #fcbfa7 0%, #f7a68b 100%);
            padding: 24px;
            border-radius: 8px;
            margin-bottom: 30px;
            border: 2px solid #f7a68b;
        }
        .ai-section h3 {
            color: #004237;
            margin-bottom: 12px;
            font-size: 18px;
        }
        .ai-section p {
            color: #004237;
            margin-bottom: 16px;
            line-height: 1.6;
            opacity: 0.9;
        }
        .btn-ai {
            background: #004237;
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
        }
        .btn-ai:hover {
            background: #003329;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 66, 55, 0.3);
        }
        .btn-ai:disabled {
            background: #999;
            cursor: not-allowed;
            transform: none;
        }
        .loading-spinner {
            display: none;
            margin-left: 12px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #004237;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            vertical-align: middle;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .segment-profile {
            background: white;
            padding: 20px;
            border-radius: 6px;
            margin-top: 16px;
            display: none;
        }
        .segment-profile.show {
            display: block;
        }
        .segment-profile h4 {
            color: #004237;
            margin-bottom: 12px;
            font-size: 16px;
        }
        .segment-profile ul {
            list-style: none;
            padding: 0;
        }
        .segment-profile li {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            color: #333;
            font-size: 14px;
        }
        .segment-profile li:last-child {
            border-bottom: none;
        }
        .explanation-panel {
            background: #f7f3e5;
            padding: 20px;
            border-radius: 6px;
            margin-top: 20px;
            border-left: 4px solid #004237;
            display: none;
        }
        .explanation-panel.show {
            display: block;
        }
        .explanation-panel h4 {
            color: #004237;
            margin-bottom: 12px;
            font-size: 16px;
        }
        .explanation-panel p {
            color: #333;
            line-height: 1.6;
            font-size: 14px;
            margin-bottom: 12px;
        }
        .form-container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .form-group {
            margin-bottom: 24px;
        }
        label {
            display: block;
            color: #004237;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        input[type="text"], textarea, select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #004237;
        }
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 30px;
        }
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }
        .btn-primary {
            background: #004237;
            color: white;
        }
        .btn-primary:hover {
            background: #003329;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 66, 55, 0.3);
        }
        .btn-cancel {
            background: #e0e0e0;
            color: #666;
        }
        .btn-cancel:hover {
            background: #d0d0d0;
        }
        .help-text {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Create New Campaign</h1>
            <p style="margin-top: 8px; opacity: 0.9;">Set up a new email campaign for The Keyes Company</p>
        </div>
        
        <div class="ai-section">
            <h3>AI Campaign Generator</h3>
            <p>Select your target segment below, then click "Generate with AI" to automatically create campaign content using Harry Dry's 25 copywriting principles. The AI will analyze your audience and generate personalized, conversion-focused copy.</p>
            <button type="button" class="btn-ai" id="generateBtn" onclick="generateCampaign()">
                Generate Campaign with AI
            </button>
            <span class="loading-spinner" id="loadingSpinner"></span>
            
            <div class="segment-profile" id="segmentProfile"></div>
            <div class="explanation-panel" id="explanationPanel"></div>
        </div>
        
        <div class="form-container">
            <form method="POST" id="campaignForm">
                <div class="form-group">
                    <label>Campaign Name *</label>
                    <input type="text" name="name" id="name" required placeholder="e.g., Spring 2025 Equity Campaign">
                    <div class="help-text">Internal name for this campaign (will be used to generate campaign ID)</div>
                </div>
                
                <div class="form-group">
                    <label>Target Segment *</label>
                    <select name="segment" id="segment" onchange="updateSegmentProfile()">
                        <option value="all-cash" {{SELECTED_ALL_CASH}}>All Cash Buyers</option>
                        <option value="absentee-instate" {{SELECTED_ABSENTEE_INSTATE}}>Absentee Owner (In-State)</option>
                        <option value="absentee-outstate" {{SELECTED_ABSENTEE_OUTSTATE}}>Absentee Owner (Out-of-State)</option>
                        <option value="general" {{SELECTED_GENERAL}}>General Past Clients</option>
                        <option value="homes-over-$2,000,000" {{SELECTED_LUXURY}}>Homes Over $2,000,000</option>
                    </select>
                    <div class="help-text">Which client segment is this campaign targeting?</div>
                </div>
                
                <div class="form-group">
                    <label>Email Subject Line *</label>
                    <input type="text" name="subject" id="subject" required placeholder="e.g., Unlock Your Home's Hidden Wealth">
                </div>
                
                <div class="form-group">
                    <label>Main Headline *</label>
                    <input type="text" name="headline" id="headline" required placeholder="e.g., Your Fresh Start, Starts Here">
                    <div class="help-text">Primary headline shown in the email</div>
                </div>
                
                <div class="form-group">
                    <label>Subheadline *</label>
                    <input type="text" name="subheadline" id="subheadline" required placeholder="e.g., Discover how much equity you could unlock...">
                </div>
                
                <div class="form-group">
                    <label>Body Copy *</label>
                    <textarea name="body_copy" id="body_copy" required placeholder="Enter the main content text for your email campaign..."></textarea>
                    <div class="help-text">Main content text for the email</div>
                </div>
                
                <div class="form-group">
                    <label>Call-to-Action Button Text *</label>
                    <input type="text" name="cta_text" id="cta_text" required value="Get Your Free Equity Strategy">
                </div>
                
                <div class="form-group">
                    <label>Campaign Status</label>
                    <select name="status">
                        <option value="draft">Draft</option>
                        <option value="active">Active</option>
                        <option value="paused">Paused</option>
                    </select>
                </div>
                
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">Create Campaign</button>
                    <a href="/campaigns" class="btn btn-cancel">Cancel</a>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // Update segment profile when segment changes
        function updateSegmentProfile() {
            const segmentId = document.getElementById('segment').value;
            const profileDiv = document.getElementById('segmentProfile');
            
            fetch(`/api/segment-profile/${segmentId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        profileDiv.classList.remove('show');
                        return;
                    }
                    
                    let html = `
                        <h4>${data.name}</h4>
                        <ul>
                            <li><strong>Demographics:</strong> ${data.demographics}</li>
                            <li><strong>Psychographics:</strong> ${data.psychographics}</li>
                            <li><strong>Communication Style:</strong> ${data.communication_style}</li>
                        </ul>
                    `;
                    
                    profileDiv.innerHTML = html;
                    profileDiv.classList.add('show');
                })
                .catch(error => {
                    console.error('Error fetching segment profile:', error);
                    profileDiv.classList.remove('show');
                });
        }
        
        // Generate campaign with AI
        function generateCampaign() {
            const segmentId = document.getElementById('segment').value;
            const campaignName = document.getElementById('name').value || 'New Campaign';
            const generateBtn = document.getElementById('generateBtn');
            const spinner = document.getElementById('loadingSpinner');
            
            // Show loading state
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generating...';
            spinner.style.display = 'inline-block';
            
            fetch('/api/generate-campaign', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    segment_id: segmentId,
                    campaign_name: campaignName
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    alert('Error generating campaign: ' + data.error);
                    return;
                }
                
                // Fill in form fields
                document.getElementById('subject').value = data.subject_line || '';
                document.getElementById('headline').value = data.headline || '';
                document.getElementById('subheadline').value = data.subheadline || '';
                document.getElementById('body_copy').value = data.body_copy || '';
                document.getElementById('cta_text').value = data.cta_button_text || 'Get Your Free Equity Strategy';
                
                // Show explanation
                const explanationDiv = document.getElementById('explanationPanel');
                if (data.explanation) {
                    explanationDiv.innerHTML = `
                        <h4>Why This Copy Works</h4>
                        <p>${data.explanation.replace(/\n/g, '</p><p>')}</p>
                    `;
                    explanationDiv.classList.add('show');
                }
                
                // Scroll to form
                document.getElementById('campaignForm').scrollIntoView({ behavior: 'smooth' });
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error generating campaign. Please try again.');
            })
            .finally(() => {
                // Reset button state
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generate Campaign with AI';
                spinner.style.display = 'none';
            });
        }
        
        // Load segment profile on page load
        window.addEventListener('DOMContentLoaded', updateSegmentProfile);
    </script>
</body>
</html>

